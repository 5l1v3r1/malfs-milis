# Description: The cross-platform media player and streaming server
# URL: http://www.videolan.org/vlc/
# Maintainer:  Thomas Penteker, tek at serverop dot de
# Packager: milisarge@gmail.com
# Depends on: libmad, ffmpeg, qt4, libdvdnav, liba52, libgcrypt

name=vlc
version=2.2.1
release=1
source=(http://download.videolan.org/pub/videolan/$name/$version/$name-$version.tar.xz)

build() {
  cd $name-$version

  # allow building with new avcodec
  sed -i 's/ 56/ 57/g' configure.ac
  autoreconf -fi

  # initialize avformat structure
  sed -i 's/AVProbeData *pd;/AVProbeData pd={};/g' modules/demux/avformat/demux.c


  ./configure --prefix=/usr \
    --mandir=/usr/man \
    --disable-nls \
    --disable-fribidi \
    --disable-httpd \
    --disable-dbus \
    --enable-alsa \
    --disable-remoteosd \
    --disable-lua
  make
  make DESTDIR=$PKG install
  rm -rf $PKG/usr/share/doc

  # fix desktop file
  sed -i 's/--started-from-file//g' $PKG/usr/share/applications/vlc.desktop
}