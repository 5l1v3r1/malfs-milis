# Tanım:	QEMU, iyi öykünme hızı elde etmek için dinamik çeviri kullanan bir işlemci öykünücüsüdür (PC, PowerPC, PowerMac, güneş, Mips, ARM vb.)
# URL: http://www.qemu.org
# Paketçi: milisarge
# Gerekler: gtk2 gtk3 sdl glib python vte vte3 xorg-mesa nss lzo cyrus-sasl alsa-lib alsa-plugins alsa-utils curl check bluez ncurses nfs-utils libgcrypt libcap-ng gnutls libusb bzip2 usbutils bridge-utils

isim=qemu-all
surum=2.6.0
devir=1
kaynak=(http://wiki.qemu.org/download/qemu-$surum.tar.bz2)

derle() {

  cd qemu-$surum
  
  ./configure --prefix=/usr \
      --cc="${CC:=gcc}" \
      --host-cc="${CC:=gcc}" \
      --sysconfdir=/etc \
      --disable-docs \
      --libexecdir=/usr/lib/qemu \
      --disable-gtk \
      --localstatedir=/var

  # Düzeltme, libcap ile ilgili sorunları içerir
  sed -i -e '/#include "qemu\/xattr.h"/d' \
         -e 's|#include <sys/resource.h>|#include <sys/resource.h>\r\n#include "qemu\/xattr.h"|g' \
  fsdev/virtfs-proxy-helper.c

  make ${MAKEFLAGS:=}
  make DESTDIR=$PKG install

  make qemu.1 qemu-img.1 qemu-nbd.8
  install -D -m 644 qemu.1 $PKG/usr/share/man1/qemu.1
  install -D -m 644 qemu-img.1 $PKG/usr/share/man1/qemu-img.1
  install -D -m 644 qemu-nbd.8 $PKG/usr/share/man8/qemu-nbd.8

  install -d $PKG/etc/udev/rules.d/
  echo 'KERNEL=="kvm", NAME="kvm", OWNER="root", GROUP="kvm", MODE="0660"' > \
  $PKG/etc/udev/rules.d/60-kvm.rules

}
